#include <math.h>

/* bfranken TODO fix missing source and copyright notice */

float scalbn(float x, int n) {
  union {
    float f;
    unsigned int i;
  } u;
  float y = x;
  int status = 0;

  if (n > 127) {
    y *= 170141183460469231731687303715884105728.0f;
    n -= 127;
    if (n > 127) {
      y *= 170141183460469231731687303715884105728.0f;
      n -= 127;
      if (n > 127)
        n = 127;
    }
  } else if (n < -126) {
    y *=  0.0000000000000000000000000000000000000117549435082228750796873653722224567781866555677208752150875171f * 16777216.0f;
    n += 126 - 24;
    if (n < -126) {
      y *= 0.0000000000000000000000000000000000000117549435082228750796873653722224567781866555677208752150875171f * 16777216.0f;
      n += 126 - 24;
      if (n < -126)
        n = -126;
    }
  }
  u.i = (unsigned int)(127.0f+n)<<23;
  x = y * u.f;
  return x;
}
